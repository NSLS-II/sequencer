TOP = ../..

include $(TOP)/configure/CONFIG
#----------------------------------------
#  ADD MACRO DEFINITIONS AFTER THIS LINE

#  Internal debug control
#USR_CPPFLAGS = -DDEBUG

#  snc product
PROD_HOST += snc

# parser generator tool 
PROD_HOST += lemon

snc_LIBS += $(EPICS_BASE_IOC_LIBS)

#snc_SRCS += snl.re		# lexer spec
#snc_SRCS += snl.lem		# parser spec

snc_SRCS += lexer.c		# generated by re2c
snc_SRCS += snl.c		# generated by lemon

snc_SRCS += snc_main.c		# main program
snc_SRCS += parse.c		# parse routines
snc_SRCS += analysis.c		# analysis routines
snc_SRCS += gen_code.c		# code generation
snc_SRCS += gen_ss_code.c	# code generation (state sets)
snc_SRCS += gen_tables.c	# code generation (tables)
snc_SRCS += sym_table.c		# symbol table

snc_LIBS += Com

ifdef LEXER_TEST
PROD_HOST =
TESTPROD_HOST = lexer
USR_CFLAGS = -DTEST_LEXER
endif

lemon_SRCS = lemon.c		# parser generator

LEMON = $(INSTALL_BIN)/lemon

include $(TOP)/configure/RULES
#----------------------------------------
#  ADD RULES AFTER THIS LINE

snc_main.o: snc_version.h

#  How to generate the version file
snc_version.h: ../sncVersion.pl $(TOP)/configure/CONFIG
	$(PERL) $< $(SEQ_VERSION) > $@.tmp
	$(MV) $@.tmp $@

snl.c snl.h: snl.lem snl.lt $(LEMON)
	$(RM) $@
	$(LEMON) snl.lem

%.lem: ../%.lem
	$(CP) $< .

%.lt: ../%.lt
	$(CP) $< .

vpath %.re ..

lexer.c: snl.re snl.h
	re2c -o $@ $<
