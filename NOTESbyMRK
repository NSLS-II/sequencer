Version 2.0.1 of the Sequencer

Marty Kraimer


Eric Norum, Janet Anderson, and I spent some time making the sequencer work
with EPICS release 3.14.0alpha2. We are NOT responsible for the sequencer.
Version 2.0.1 should be considered an interim release until
Greg White and Ron Chestnut have time to become familiar with
the changes we made.

We did not update the SNL/SEQ manual. The following breifly describes
documentation changes needed for the 2.0.0 reference manual.


New Compiler Option

+i Code will be generated to automatically register sequence functions
and state programs. This is the default

-i Do not generate registration code. Only useful on vxWorks to save a small amount of memory.

Compiling and linking a state program under Unix.

The exampleApp supplied with base demonstrates how to build sequence programs
that work with epics databases.
It also shows how to build a sequence program that runs without databases.

test/simple also shows how to build a sequence program that runs 
without databases running in the same process.

The main program generated by the +m compiler options looks like.

int main(int argc,char *argv[]) {
    char * macro_def;
    epicsThreadId threadId;
    int callIocsh = 0;
    if(argc>1 && strcmp(argv[1],"-s")==0) {
        callIocsh=1;
        --argc; ++argv;
    }
    macro_def = (argc>1)?argv[1]:NULL;
    threadId = seq((void *)&snctest, macro_def, 0);
    if(callIocsh) {
        iocsh(0);
    } else {
        epicsThreadExitMain();
    }
    return(0);
}


Such a program is invoked via the call like

<name> -s "xxx=xxx,..."

If the -s option is specified iocsh is started. This allows the user
to issue sequence commands like seqShow. If the -s option is not given,
the shell is not started. If a program is started as a background process
the -s option should not be specified.

The other option argument is macro substitutions.

Comments about changes made for release 2.0.1

I think config should be removed. Just require 3.14 and later


in test/simple and test/validate
     assign v to "grw:xxxExample";
     changed to
     assign v to "{user}:xxxExample";

in src/dev
    dev.c renamed to devSequencer.c
    seq.dbd renamed to devSequencer.dbd

in src/snc
    The generated main program is different. See below
    New option -i. See above
    Made many changes to get rid of warning messages.

in src/seq
    seq now returns an epicsThreadId
    all addesses now printed with %p
    several epicsPrintf replaced with printf.
    Got rid of simple shell supplied by seq. No longer needed.

in src/pv

    Only LIBRARY = pv is generated. It includes the stuff
    that was in pvKtl, pvCa, and pvFile if they are requested.
    This was done because the old way caused a circircular dependency
    that is not accepted by windows.
    
